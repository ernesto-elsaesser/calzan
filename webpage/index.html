<!DOCTYPE html>
<html>
    <head>
        <title>Die Baustelle von Calzan</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta charset="utf-8" />

        <style>
            .player {
                width: 100px;
                height: 40px;
                display: inline-block;
            }
            #board {
                background-color: deepskyblue;
                width: 640px;
                height: 640px;
                margin: 20px auto;
                position: relative;
                border-radius: 50px;
            }
            .token {
                position: absolute;
                border-radius: 50%;
            }
            .token p {
                text-align: center;
                vertical-align: center;
                height: 100%;
                font-size: 32px;
            }
            .tile {
                height: 100px;
                width: 100px;
            }
            .city {
                height: 50px;
                width: 50px;
            }
            .road {
                height: 25px;
                width: 25px;
            }
        </style>
    </head>
    <body>
        <div style="text-align: center">
            <h3>SPIELER</h3>
            <div id="players"></div>
            <div style="margin: 20px">
                Holz: <span id="Holz">0</span> Lehm: <span id="Lehm">0</span> Stroh: <span id="Stroh">0</span> Schafe: <span id="Schafe">0</span> Granit: <span id="Granit">0</span> Siegpunkte: <span id="Siegpunkte">0</span>
            </div>
            <div>WÃ¼rfel: <span id="dice">-</span></div>
            <div id="board"></div>
        </div>

        <script src="/__/firebase/8.10.1/firebase-app.js"></script>
        <script src="/__/firebase/8.10.1/firebase-database.js"></script>
        <script src="/__/firebase/init.js"></script>
        <script>

const players = document.getElementById("dice");
const dice = document.getElementById("dice");
const board = document.getElementById("board");

var colorMap = {
    'Sand': 'moccasin',
    'Holz': 'darkgreen',
    'Lehm': 'chocolate',
    'Stroh': 'gold',
    'Schafe': 'chartreuse',
    'Granit': 'dimgray'
};

var data = null;
var chosenColor = null;

function update() {

    if (data == null) {
        return;
    }

    players.innerHTML = "";

    for (const color of Object.keys(data.players)) {
        const button = document.createElement('button');
        button.className = 'player';
        button.style.backgroundColor = color;
        button.onclick = function() { chosenColor = color; update(); };
        players.appendChild(button);
    }

    dice.innerHTML = data.dice.toString();

    board.innerHTML = "";

    for (const tileData of Object.values(data.tiles)) {
        var tile = document.createElement('div');
        tile.className = 'token tile';
        var top = 60 + (tileData.y * 100);
        var left = 30 + (tileData.x * 60);
        tile.style.top = top.toString() + 'px';
        tile.style.left = left.toString() + 'px';
        tile.style.backgroundColor = colorMap[tileData.type];
        if (tileData.num) {
            var label = document.createElement('p');
            label.innerHTML = tileData.num.toString();
            tile.appendChild(label);
        }
        board.appendChild(tile);
    }

    if (chosenColor == null) {
        return;
    }

    const playerData = data.players[chosenColor];

    for (const [name, amount] of Object.entries(playerData.stats)) {
        document.getElementById(name).innerHTML = amount.toString();
    }
}

firebase.database().ref('/').on('value', (snapshot) => {
  data = snapshot.val();
  update();
});
        </script>
    </body>
</html>
